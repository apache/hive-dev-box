#!/bin/bash -ex

type=${1:-derby}

echo "@ initializing: $type"

case $type in
    derby)
        D=/data/hive/metastore_db
        rm -rf $D
        conf del hive/hive-site javax.jdo.option.ConnectionDriverName
        conf set hive/hive-site javax.jdo.option.ConnectionURL "jdbc:derby:;databaseName=/data/hive/metastore_db;create=true"
        conf del hive/hive-site javax.jdo.option.ConnectionUserName
        conf del hive/hive-site javax.jdo.option.ConnectionPassword
    ;;
    postgres)
        sudo -u postgres dropdb metastore
        sudo -u postgres createdb metastore -O hiveuser
        conf set hive/hive-site javax.jdo.option.ConnectionDriverName org.postgresql.Driver
        conf set hive/hive-site javax.jdo.option.ConnectionURL 'jdbc:postgresql://localhost/metastore'
        conf set hive/hive-site javax.jdo.option.ConnectionUserName hiveuser
        conf set hive/hive-site javax.jdo.option.ConnectionPassword mypassword
    ;;
    *)
        banner not impl
        exit 1
esac

/hive/bin/schematool -dbType $type -initSchema
/hive/bin/schematool -dbType hive -initSchema -metaDbType $type

banner ok

